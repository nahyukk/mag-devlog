---
title: "[Jenkins]ğŸ³ Jenkins + Docker ê¸°ë°˜ ë°°í¬ ìë™í™” & DooD êµ¬ì„± íŠ¸ëŸ¬ë¸”ìŠˆíŒ…"
description: "Jenkins ì»¨í…Œì´ë„ˆ ê¸°ë°˜ìœ¼ë¡œ Dockerë¥¼ ì œì–´í•˜ëŠ” ìë™í™” ë°°í¬ í™˜ê²½ì„ êµ¬ì¶•í•˜ë©° ê²ªì—ˆë˜ ì‚½ì§ˆê³¼ í•´ê²° ê³¼ì •ì„ ì •ë¦¬í•©ë‹ˆë‹¤."
date: "2025.05.30"
filter: ["Jenkins", "Infra", "CI/CD"]
---

ì§€ë‚œë²ˆ ì„œë²„ì— ì  í‚¨ìŠ¤ë¥¼ ë„ìš°ê¸°ëŠ” í–ˆìœ¼ë‚˜, git pushê°€ ì•ˆë˜ëŠ” ë¶ˆìƒì‚¬ê°€ ìƒê²¼ë‹¤. ë³„ë„ì˜ íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ìœ¼ë¡œ ì •ë¦¬í•œë‹¤.

## ëª©í‘œ
- [x] GitHub push â†’ Jenkins â†’ Docker Compose ë¹Œë“œ ë° ì‹¤í–‰

- [x] Discord Webhookìœ¼ë¡œ ìƒíƒœ ì•Œë¦¼

- [x] Jenkins ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ Docker Compose ì§ì ‘ ì‹¤í–‰ (DooD)

---

### Jenkinsfile
<br />

```shell
pipeline {
  agent any
  triggers {
    githubPush()
  }
  stages {
    stage('Deploy') {
      steps {
        withCredentials([string(credentialsId: 'discord-webhook', variable: 'WEBHOOK_URL')]) {
          dir('/home/ubuntu/zaro-main') {
            sh '''
              echo "Git pull ì¤‘..."
              if git pull origin main; then
                  curl -X POST -H "Content-Type: application/json" -d '{"content": "Git pull ì„±ê³µ!"}' $WEBHOOK_URL
              else
                  curl -X POST -H "Content-Type: application/json" -d '{"content": "Git pull ì‹¤íŒ¨!"}' $WEBHOOK_URL
                  exit 1
              fi

              curl -X POST -H "Content-Type: application/json" -d '{"content": "Docker ë°°í¬ ì‹œì‘..."}' $WEBHOOK_URL
              docker-compose -f docker-compose.prod.yml down --rmi all

              if docker-compose -f docker-compose.prod.yml up -d --build; then
                  curl -X POST -H "Content-Type: application/json" -d '{"content": "ë°°í¬ ì™„ë£Œ!"}' $WEBHOOK_URL
              else
                  curl -X POST -H "Content-Type: application/json" -d '{"content": "Docker ì‹¤íŒ¨"}' $WEBHOOK_URL
                  exit 1
              fi
            '''
          }
        }
      }
    }
  }
}
```

- `withCredentials`ë¡œ Webhook í™˜ê²½ë³€ìˆ˜ ì „ë‹¬, `sh` ë¸”ë¡ ë‚´ì—ì„œ ë°°í¬ ë° Discord ì•Œë¦¼ê¹Œì§€ í¬í•¨.

<ThickLine />

## ğŸš¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

#### 1. Credential Not Found

```text
ERROR: Could not find credentials entry with ID 'discord-webhook'
```

- Jenkins ì„¤ì • â†’ Credentialsì— ID `discord-webhook`

**í•´ê²°**: webhook credentials id ì´ë¦„ ì˜ëª» ì”€

---

#### 2. í¼ë¯¸ì…˜ ì´ìŠˆ: ì»¨í…Œì´ë„ˆê°€ `/home/ubuntu` ì ‘ê·¼ ë¶ˆê°€

```text
java.nio.file.AccessDeniedException: /home/ubuntu
```
- ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ UID 1000ë²ˆì—ê²Œ ê¶Œí•œ ì£¼ê¸°

```bash
sudo chown -R 1000:1000 /home/ubuntu/zaro-main
```
-> ì•ˆë¨.
<br />

**í•´ê²°:**

```bash
sudo chown -R 1000:1000 /home/ubuntu
sudo chmod 755 /home/ubuntu
```

- ë” í° ë²”ìœ„ì—ì„œ ê¶Œí•œ ë¶€ì—¬

---
#### 3. ì—¬ì „í•œ ê¶Œí•œ ë¬¸ì œ



```text
ls -al
```
- ì  í‚¨ìŠ¤ ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ

```bash
drwxr-xr-x 7 ubuntu ubuntu 4096 May 30 07:20 /home/ubuntu/zaro-main
```
- ubuntu ìœ ì €ë§Œ ì“°ê¸° ê°€ëŠ¥, Jenkins ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ Jenkins ìœ ì €ê°€ ì´ ê²½ë¡œì— ì ‘ê·¼í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ë ¤ë©´ ê¶Œí•œ ì¡°ì •ì´ í•„ìš”

<aside>
**host-container êµ¬ì¡°**
- Host: ì‹¤ì œ ë¬¼ë¦¬ì ì¸ ì„œë²„ ë˜ëŠ” EC2 ì¸ìŠ¤í„´ìŠ¤
- Container: Host ìœ„ì—ì„œ ëŒì•„ê°€ëŠ” ê°€ìƒ í™˜ê²½ (Jenkins, Nginx, Spring ë“±)
</aside>
- ë‘˜ ì‚¬ì´ ë””ìŠ¤í¬ ìì› ê³µìœ ë¥¼ ìœ„í•´ volume mount ë°©ì‹ ì‚¬ìš©
<br />

**Jenkins ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ .sshí‚¤ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ ì—°ê²°ì´ í•„ìš”**

- ì»¨í…Œì´ë„ˆ ì•ˆì—ì„œ ì‹¤í–‰
```bash
docker exec -it jenkins bash
```
<br />
```bash
ssh-keyscan github.com >> ~/.ssh/known_hosts
```
- Jenkins ì»¨í…Œì´ë„ˆì— ì§ì ‘ ë“¤ì–´ê°€ì„œ GitHub SSH í‚¤ ë“±ë¡ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ëª…ë ¹ì–´

- ë„ì»¤ ì»´í¬ì¦ˆ ì„¤ì •
```bash
volumes:
  - /home/ubuntu/jenkins_ssh:/var/jenkins_home/.ssh
```

---

#### 4. DooD (Docker-outside-of-Docker) ì„¤ì •

- CI/CD ìš©ë„ë¡œëŠ” DooD ë§ì´ ì“´ë‹¤ê³  í•œë‹¤.

```bash
apt update && apt install -y docker.io docker-compose
```
- Jenkins ì»¨í…Œì´ë„ˆì— Docker ì„¤ì¹˜

```bash
usermod -aG docker jenkins
```
- ë„ì»¤ ì‹¤í–‰ ê¶Œí•œ â†’ ì¬ì‹œì‘

```yaml
volumes:
  - /var/run/docker.sock:/var/run/docker.sock
```
- ë„ì»¤ ì»´í¬ì¦ˆ í™•ì¸


```yaml
docker exec -it -u root jenkins /bin/bash
```
- Jenkins ì»¨í…Œì´ë„ˆ ì•ˆìœ¼ë¡œ root ê¶Œí•œìœ¼ë¡œ ë“¤ì–´ê°€ê¸°

```yaml
chown jenkins:jenkins /home/ubuntu
```
- `/home/ubuntu` ë””ë ‰í† ë¦¬ì˜ ì†Œìœ ìë¥¼ jenkins ìœ ì €ë¡œ ë°”ê¿”ì¤Œ
<br />
**ê¶Œí•œ ë¬¸ì œëŠ” í•´ê²°!!**


---

#### 5. ë‚˜ë¨¸ì§€ í•´ê²°ë¬ì§€ë§Œ.. Git Pullì—ì„œ ì‹¤íŒ¨

```bash
git status
```
- ì–´ì œ ë„ì»¤ë‘ ì˜ ë§ˆìš´íŠ¸ ë˜ì—ˆëŠ”ì§€ ì²´í¬í•˜ë ¤ê³  íŒŒì¼ í•˜ë‚˜ ë§Œë“¤ì–´ ë‘” ê²ƒì´ ë¬¸ì œ..ã…ã…

```bash
git clean -fd
```

- ì˜ ì§€ì›Œì¤¬ë‹¤.

```bash
git diff
```
- í™•ì¸í•´ë³´ë‹ˆ.. ë¬´ì–¸ê°€ê°€ ëœ¬ë‹¤.

```bash
old mode 100644
new mode 100755
```
- ëª¨ë“œê°€ ë°”ë€Œì—ˆë‹¤ê³  í•œë‹¤.
   - íŒŒì¼ í¼ë¯¸ì…˜(mode)ì´ ë³€ê²½ë¨. 644 â†’ 755ëŠ” ì‹¤í–‰ ê¶Œí•œì´ ìƒê¹€. Jenkinsë‚˜ Docker ë¹Œë“œ ì¤‘ì— ìƒê¸¸ ìˆ˜ ìˆëŠ” ë¬¸ì œ.

```bash
git config core.fileMode false
```
<br />
**í•´ê²°~**

---

## âœ¨ ë§ˆë¬´ë¦¬

* Jenkins ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ìë™í™” í™˜ê²½ì€ ë‹¨ìˆœíˆ ëŒì•„ê°€ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê¶Œí•œ, ë§ˆìš´íŠ¸, í¼ë¯¸ì…˜, Git, Docker ì„¤ì • ë“± ë‹¤ì–‘í•œ ìš”ì†Œê°€ ë§ë¬¼ë¦¼
* íŠ¹íˆ Jenkins ë‚´ì—ì„œ Dockerë¥¼ ì§ì ‘ ì œì–´í•  ë•ŒëŠ” **DooD êµ¬ì„±ê³¼ ê¶Œí•œ ê´€ë¦¬**ê°€ í•µì‹¬

---
